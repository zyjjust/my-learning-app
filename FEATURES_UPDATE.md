# 功能更新说明

## 已实现的功能

### 1. ✅ 连续登录天数累加
- 根据用户实际登录日期计算连续登录天数
- 如果今天登录且昨天也登录，天数累加
- 如果中断登录，重置为1
- 数据保存在 `users` 表的 `last_login_date` 和 `streak` 字段

### 2. ✅ 经验值初始化为0
- 新用户经验值初始值为0
- 完成任务时不再增加经验值
- 只保留金币奖励系统

### 3. ✅ 移除经验值显示，只保留金币
- 移除了经验值进度条
- 移除了任务中的经验值奖励显示
- 只显示金币奖励
- 顶部显示金币数量

### 4. ✅ 已兑换商品表
- 创建了 `purchased_items` 表存储已兑换商品
- 购买商品时弹出确认窗口
- 确认后保存到数据库

### 5. ✅ 已购买商品菜单
- 在奖励商店中添加"我的商品"按钮
- 点击后显示已购买的所有商品
- 支持查看购买历史

## 数据库更新

### 需要执行的 SQL

1. **更新 users 表**（添加最后登录日期字段）：
```sql
ALTER TABLE public.users 
ADD COLUMN IF NOT EXISTS last_login_date DATE;

CREATE INDEX IF NOT EXISTS idx_users_last_login_date ON public.users(last_login_date);
```

2. **创建 purchased_items 表**：
执行 `database/purchased-items-table.sql` 文件中的 SQL 语句

## 功能说明

### 连续登录天数逻辑
- 首次登录：连续天数为1
- 连续登录：如果昨天登录，今天登录，天数+1
- 中断登录：如果上次登录不是昨天，重置为1

### 金币系统
- 完成任务获得金币
- 使用金币购买商品
- 金币数量实时同步到数据库

### 购买流程
1. 点击"购买"按钮
2. 弹出确认窗口，显示商品信息和所需金币
3. 确认后扣除金币并保存到数据库
4. 商品添加到"我的商品"列表

## 使用说明

1. **执行数据库更新**：
   - 在 Supabase SQL Editor 中执行 `database/purchased-items-table.sql`

2. **测试功能**：
   - 完成任务获得金币
   - 在商店中购买商品（会弹出确认窗口）
   - 点击"我的商品"查看已购买的商品

3. **连续登录测试**：
   - 今天登录后，连续天数会更新
   - 明天登录，如果今天也登录过，天数会累加

## 注意事项

- 经验值字段仍然保留在数据库中，但不再使用
- 已购买的商品会永久保存，不会因为刷新而丢失
- 连续登录天数基于日期计算，不是基于时间戳


